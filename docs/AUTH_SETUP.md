# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ NextAuth

## –≠—Ç–∞–ø 12 ‚Äî NextAuth (Google) ‚úÖ

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. **NextAuth –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - `app/api/auth/[...nextauth]/route.ts`
   - Google OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä
   - PrismaAdapter –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
   - JWT —Å–µ—Å—Å–∏–∏
   - –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞ –∏ –æ—à–∏–±–æ–∫

2. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ `/auth/signin`
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–∫–∏ `/auth/signin/error`
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `AuthButtons` —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è `/profile`

3. **–°–µ—Ä–≤–µ—Ä–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã**
   - `lib/server/auth.ts` - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - –ó–∞—â–∏—â–µ–Ω–Ω—ã–π API endpoint `/api/test-auth`

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
   - SessionProvider –≤ –∫–æ—Ä–Ω–µ–≤–æ–º layout
   - –ö–Ω–æ–ø–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ —Ö–µ–¥–µ—Ä–µ –ª–µ–Ω–¥–∏–Ω–≥–∞
   - –ü–µ—Ä–µ–≤–æ–¥—ã –Ω–∞ RU/KZ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local`** –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```bash
# Database
DATABASE_URL="file:./dev.db"

# NextAuth
NEXTAUTH_SECRET="your-32-character-secret-here-change-in-production"
NEXTAUTH_URL="http://localhost:3000"

# Google OAuth (–∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏)
GOOGLE_CLIENT_ID="your-google-client-id"
GOOGLE_CLIENT_SECRET="your-google-client-secret"

# App
NODE_ENV="development"
LOG_LEVEL="info"
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google OAuth**:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
   - –í–∫–ª—é—á–∏—Ç–µ Google+ API
   - –°–æ–∑–¥–∞–π—Ç–µ OAuth 2.0 credentials
   - –î–æ–±–∞–≤—å—Ç–µ `http://localhost:3000/api/auth/callback/google` –≤ Authorized redirect URIs
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Client ID –∏ Client Secret –≤ `.env.local`

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**:
```bash
npm run db:local
npm run prisma:generate
npm run prisma:migrate
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**:
```bash
npm run dev
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é**:
   - –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000`
   - –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏" –≤ —Ö–µ–¥–µ—Ä–µ
   - –í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å `/profile`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π API

3. **API —Ç–µ—Å—Ç**:
   - GET `/api/test-auth` - –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401 –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - GET `/api/test-auth` —Å —Å–µ—Å—Å–∏–µ–π - –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [...nextauth]/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ route.ts          # NextAuth –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test-auth/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts              # –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞—â–∏—â–µ–Ω–Ω—ã–π API
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signin/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx              # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx              # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ profile/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx                  # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ AuthButtons.tsx               # –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ SessionProvider.tsx           # NextAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îÇ       ‚îú‚îÄ‚îÄ avatar.tsx                # –ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ       ‚îî‚îÄ‚îÄ dropdown-menu.tsx         # –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ server/
        ‚îî‚îÄ‚îÄ auth.ts                   # –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
```

### DoD (Definition of Done)

‚úÖ **–ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** - PrismaAdapter –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö User/Account/Session

‚úÖ **–ó–∞—â–∏—â—ë–Ω–Ω—ã–µ API —á–∏—Ç–∞—é—Ç userId –∏–∑ —Å–µ—Å—Å–∏–∏** - `/api/test-auth` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `getCurrentUser()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

‚úÖ **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç** - –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞, —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø—Ä–æ—Ñ–∏–ª—å

‚úÖ **–ü–µ—Ä–µ–≤–æ–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ RU/KZ –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

‚úÖ **–°–µ—Å—Å–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç** - JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, SessionProvider –≤ layout

‚úÖ **–ü—Ä–æ–µ–∫—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è** - –≤—Å–µ —Ç–∏–ø—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫:
- **–≠—Ç–∞–ø 13** - Billing (MoR) —Å webhooks
- **–≠—Ç–∞–ø 14** - –ö–≤–æ—Ç—ã –∏ –ª–∏–º–∏—Ç—ã
- **–≠—Ç–∞–ø 15** - Magic Fill API

---

## üéâ –≠—Ç–∞–ø 12 –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è NextAuth —Å Google –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.**

–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –¥–æ–∂–¥–∏—Ç–µ—Å—å –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: **"–¥–∞–ª—å—à–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É"**
