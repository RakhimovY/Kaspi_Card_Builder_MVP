# PRODUCT_INFO_SPEC.md — Блок «Информация о товаре» (Kaspi) v1

Этот документ описывает состав и валидации полей, источники автозаполнения (Magic Fill, OCR, GTIN) и маппинг в экспортируемый CSV. Цель — закрыть 80% требований карточек Kaspi и сократить ручной ввод.

> Локали: RU (основная), KZ (вторая). Тексты (title/description/bullets) должны иметь обе версии.

---

## 1) Ядро карточки (Core)

| Раздел | Ключ | Тип | Обяз. | Источник | Валидация | CSV колонка |
|---|---|---|---|---|---|---|
| Идентификация | sku | string | да | вручную/генерация | 3–64 символа; `[A-Za-z0-9-_]` | `sku` |
| Идентификация | gtin | string | опц. (да для брендовых) | скан/ввод | 8–14 цифр, Luhn | *(нет прямой колонки, хранить в attrs или notes)* |
| Идентификация | brand | string | да | Magic Fill/вручную | 2–60 символов | `brand` |
| Идентификация | type | string | да | Magic Fill/вручную | 2–60 символов | *(в name)* |
| Идентификация | model | string | опц. | Magic Fill/вручную | 1–60 символов | *(в name)* |
| Идентификация | keySpec | string | опц. (рекомендуется) | Magic Fill/вручную | 1–60 символов | *(в name)* |
| Название RU | titleRU | string | да | авто/вручную | 60–80 симв, без спама | `name` |
| Название KZ | titleKZ | string | да | авто/вручную | 60–80 симв | *(экспорт отдельным листом/колонкой при необходимости)* |
| Описание RU | descRU | markdown | да | авто/вручную | 500–1200 симв; 3–5 буллетов + “Характеристики” | `description` |
| Описание KZ | descKZ | markdown | да | авто/вручную | 500–1200 симв | *(см. выше)* |
| Категория | category | enum | да | вручную (пресеты) | одно из справочника | `category` |
| Атрибуты | attributes | key→value[] | опц. | Magic Fill/вручную | 1–50 пар; типобезопасные значения | `attributes_notes` |
| Цена | price | number | да | вручную | > 0; валюта KZT | `price` |
| Остаток | qty | integer | да | вручную | >= 0 | `qty` |

### Формула названия (RU/KZ)
```
<type> <brand> <model> <keySpec>
```
- 60–80 символов, без лишних знаков и суперлативов.
- Автосборка с пост-редактурой.

---

## 2) Вариации (SKU-матрица)

| Поле | Ключ | Тип | Обяз. | Валидация | Примечание |
|---|---|---|---|---|---|
| Цвет | variant.color | enum | опц. | из справочника | для одежды/косметики/электроники |
| Размер | variant.size | enum | опц. | EU/US/см; нормализатор | для одежды/обуви |
| Объём/Ёмкость | variant.capacity | number|string | опц. | 1–10000; с единицами | мл/ГБ/Вт⋅ч — типзависимо |
| Совместимость | variant.compat | string | опц. | ≤ 120 симв | для аксессуаров |
| Артикул варианта | variant.sku | string | да, если есть вариации | как sku | уникален в рамках товара |

> Для CSV: варианты можно дублировать в отдельные строки с разными `sku` и одинаковым `name`/`description` и своими `image1..8` при необходимости.

---

## 3) Медиаконтент

| Поле | Ключ | Тип | Обяз. | Валидация | CSV |
|---|---|---|---|---|---|
| Главное фото | images[0] | file | да | фон удалён; 1000–3000px по большей стороне; ≤25MB; JPEG/WebP | `image1` |
| Доп. фото | images[1..7] | file[] | опц. | 500–5000px; ≤25MB; до 8 шт | `image2..image8` |

Рекомендации:
- Белый/нейтральный фон для главного фото.
- Не добавлять водяные знаки/логотипы/рамки.
- EXIF удаляется. Формат по умолчанию — WebP, fallback — JPEG (~0.82).

---

## 4) Логистика и соответствие (опционально, но повышает модерацию)

| Поле | Тип | Пример | Где хранить |
|---|---|---|---|
| Вес (нетто/брутто) | number(кг) | 0.45 | attributes |
| Габариты упаковки (Д×Ш×В) | number(см)×3 | 20×15×8 | attributes |
| Комплектация | string | Кабель, инструкция | description/attributes |
| Гарантия | string | 12 мес | attributes |
| Страна происхождения | string | Китай | attributes |
| Сертификат/ТР ТС | string | EAC, номер | attributes |
| Напряжение/мощность | string | 220В, 50–60Гц, 800Вт | attributes |
| Возрастные ограничения | string | 3+ | attributes |

---

## 5) Пресеты чек‑листов (категории)

### Электроника
- Указаны: бренд, модель, ключевая характеристика (память/диагональ/мощность)
- Есть: совместимость (если аксессуар), напряжение/разъёмы, гарантия
- Фото: фронт/бэк/порт/в коробке

### Одежда
- Размерная сетка (таблица), материал/состав, сезон, посадка
- Фото: на белом, на человеке, ярлык/бирка

### Косметика
- Объём/срок годности/сертификаты, способ применения, состав (INCI)
- Фото: банка/тюбик, обратная сторона с составом

---

## 6) Маппинг в CSV (экспорт)

Минимальный набор колонок:
```
sku,name,brand,category,price,qty,description,image1,image2,image3,image4,image5,image6,image7,image8,attributes_notes
```
- `name` ← `titleRU`
- `description` ← `descRU` (буллеты + «Характеристики»)
- `attributes_notes` ← сериализованные пары `key: value; …`
- Варианты → отдельные строки с собственным `sku` и изображениями.

---

## 7) Автозаполнение (Magic Fill)

При наличии `gtin` и/или фото:
1) Поиск по GTIN (кэш + внешние источники) → brand/type/model/keySpec
2) OCR по фото (fallback) → извлечение признаков
3) LLM-парсинг → `attributes`, черновик
4) Генерация `titleRU/KZ`, `descRU/KZ`
5) Сохранение `ProductDraft` + `ImageAsset`

---

## 8) Валидации UI/UX

- Подсветка обязательных полей, инлайн‑ошибки
- Прогресс‑индикатор заполненности
- Автогенерация `sku` из `<brand>-<model>` с ручной правкой
- Быстрые действия: «Сканировать штрихкод», «Сгенерировать тайтл/описание», «Заполнить по фото»

---

## 9) Дополнительно

- Локализация RU/KZ для всех текстов
- Поддержка клавиатуры и хоткеев (например, Cmd/Ctrl+S — экспорт)
- Сохранение как черновик; история изменений