# Mock Purchase Setup

## Обзор

Создан мок-сервис для покупки Pro плана, который позволяет тестировать функциональность подписок без реальных платежей через Lemon Squeezy.

## Что было реализовано

### 1. API Endpoint для мока покупки

**Файл:** `src/app/api/mock-purchase-pro/route.ts`

- **Маршрут:** `POST /api/mock-purchase-pro`
- **Аутентификация:** Требует активную сессию пользователя
- **Функциональность:**
  - Проверяет, нет ли уже активной Pro подписки
  - Отменяет существующие подписки
  - Создает новую Pro подписку на 1 месяц
  - Обновляет `lemonSqueezyCustomerId` пользователя
  - Инициализирует статистику использования

### 2. Компонент BuyProButton

**Файл:** `src/components/BuyProButton.tsx`

- Универсальная кнопка для покупки Pro плана
- Показывает различные состояния: покой, обработка, успех, ошибка
- Автоматически обновляет страницу после успешной покупки
- Поддерживает callback `onSuccess`

### 3. Обновленный LemonSqueezyTest

**Файл:** `src/components/LemonSqueezyTest.tsx`

- Добавлен переключатель Mock Mode
- В режиме мока использует наш API вместо Lemon Squeezy
- Показывает информацию о моке и отладочные сообщения

### 4. Обновления лендинга

**Файл:** `src/app/landing/page.tsx`

- Заменены кнопки Lemon Squeezy на `BuyProButton`
- Удалена сложная логика обработки Lemon Squeezy
- Упрощен код и убраны зависимости от внешних ключей

### 5. Переводы

**Файлы:** `src/messages/ru.json`, `src/messages/kz.json`

- Добавлены переводы для новых элементов интерфейса
- `pricing.buyPro`, `pricing.activated`, `common.processing`, `common.tryAgain`

### 6. Тестовая страница

**Файл:** `src/app/test-simple/page.tsx`

- Страница для тестирования всех компонентов мока
- Доступна по адресу `/test-simple`
- Содержит все три компонента: `BuyProButton`, `SubscriptionInfo`, `LemonSqueezyTest`

## Как использовать

### Для тестирования:

1. Перейдите на `/test-simple`
2. Войдите в систему через Google
3. Нажмите "Buy Pro Plan (Mock)" в любом из компонентов
4. Проверьте, что подписка создалась в базе данных
5. Страница обновится, показав новый статус подписки

### Для продакшена:

1. В `LemonSqueezyTest` переключите Mock Mode на "Disabled"
2. Настройте реальные ключи Lemon Squeezy в `.env`
3. Компонент автоматически переключится на реальные платежи

## База данных

Мок создает записи в таблицах:

- **Subscription:** новая запись с `provider: 'mock'`, `plan: 'pro'`, `status: 'active'`
- **User:** обновляется `lemonSqueezyCustomerId` на `mock_customer_{userId}`
- **UsageStat:** инициализируется для текущего месяца

## Преимущества мока

1. **Быстрое тестирование** - мгновенная активация Pro плана
2. **Независимость** - не требует внешних сервисов
3. **Отладка** - легко тестировать логику подписок
4. **Разработка** - можно работать без настройки платежных систем
5. **Демонстрация** - показать функциональность клиентам

## Ограничения

- Не обрабатывает реальные платежи
- Не интегрируется с реальными биллинговыми системами
- Не отправляет email уведомления
- Статичный период подписки (1 месяц)

## Переключение на реальные платежи

Когда будете готовы использовать реальный Lemon Squeezy:

1. Настройте переменные окружения `NEXT_PUBLIC_LEMON_SQUEEZY_*`
2. В `LemonSqueezyTest` отключите Mock Mode
3. Замените `BuyProButton` на реальную интеграцию Lemon Squeezy
4. Настройте вебхуки для обработки реальных платежей
